<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="JS,ES6," />










<meta name="description" content="迭代器之前写过一篇文章关于可迭代对象-谈谈遍历与迭代协议， 并讲述了可迭代协议(iterable protocal); 还遗留了一个迭代器协议(iterator)没有讲述，这次我们就来说一说迭代器协议； 迭代器协议MDN上是这样定义iterator protocal的： The iterator protocol defines a standard way to produce a sequen">
<meta name="keywords" content="JS,ES6">
<meta property="og:type" content="article">
<meta property="og:title" content="ES6之迭代器与生成器">
<meta property="og:url" content="http://cauil.github.io/2017/11/26/2017-11-26-ES6之迭代器与生成器/index.html">
<meta property="og:site_name" content="Cauil&#39;s Blog">
<meta property="og:description" content="迭代器之前写过一篇文章关于可迭代对象-谈谈遍历与迭代协议， 并讲述了可迭代协议(iterable protocal); 还遗留了一个迭代器协议(iterator)没有讲述，这次我们就来说一说迭代器协议； 迭代器协议MDN上是这样定义iterator protocal的： The iterator protocol defines a standard way to produce a sequen">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2017-11-26T03:53:17.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ES6之迭代器与生成器">
<meta name="twitter:description" content="迭代器之前写过一篇文章关于可迭代对象-谈谈遍历与迭代协议， 并讲述了可迭代协议(iterable protocal); 还遗留了一个迭代器协议(iterator)没有讲述，这次我们就来说一说迭代器协议； 迭代器协议MDN上是这样定义iterator protocal的： The iterator protocol defines a standard way to produce a sequen">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://cauil.github.io/2017/11/26/2017-11-26-ES6之迭代器与生成器/"/>





  <title>ES6之迭代器与生成器 | Cauil's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Cauil's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">陌上花开，可缓缓归矣</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://cauil.github.io/2017/11/26/2017-11-26-ES6之迭代器与生成器/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="cauil">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/abu.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cauil's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">ES6之迭代器与生成器</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-26T00:00:00+08:00">
                2017-11-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JS/" itemprop="url" rel="index">
                    <span itemprop="name">JS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="迭代器"><a href="#迭代器" class="headerlink" title="迭代器"></a>迭代器</h2><p>之前写过一篇文章关于可迭代对象-<a href="http://cauil.github.io/2017/09/07/2017-09-07-%E8%B0%88%E8%B0%88%E9%81%8D%E5%8E%86%E4%B8%8E%E8%BF%AD%E4%BB%A3%E5%8D%8F%E8%AE%AE/">谈谈遍历与迭代协议</a>， 并讲述了可迭代协议(iterable protocal);</p>
<p>还遗留了一个迭代器协议(iterator)没有讲述，这次我们就来说一说迭代器协议；</p>
<h4 id="迭代器协议"><a href="#迭代器协议" class="headerlink" title="迭代器协议"></a>迭代器协议</h4><p>MDN上是这样定义iterator protocal的：</p>
<p>The iterator protocol defines a standard way to produce a sequence of values (either finite or infinite).</p>
<p>An object is an iterator when it implements a next() method with the following semantics:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>next</td>
<td>A zero arguments function that returns an object with two properties:</td>
</tr>
</tbody>
</table>
<ul>
<li>done (boolean)<ul>
<li>Has the value true if the iterator is past the end of the iterated sequence. In this case value optionally specifies the return value of the iterator. The return values are explained here.</li>
<li>Has the value false if the iterator was able to produce the next value in the sequence. This is equivalent of not specifying the done property altogether.</li>
</ul>
</li>
<li>value - any JavaScript value returned by the iterator. Can be omitted when done is true.</li>
</ul>
<p>The next method always has to return an object with appropriate properties including done and value. If a non-object value gets returned (such as false or undefined), a TypeError (“iterator.next() returned a non-object value”) will be thrown. |</p>
<p>其实就是迭代器拥有一个next方法，每次调用返回含有value和done两个属性的对象，value表示下一个将要返回的值；done是一个布尔值，当没有更多返回数据时返回true；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">var someArray = [1, 5];</div><div class="line">var someArrayEntries = someArray.entries();</div><div class="line"></div><div class="line">someArrayEntries.toString();   // &quot;[object Array Iterator]&quot;</div><div class="line">someArrayEntries === someArrayEntries[Symbol.iterator](); // true</div><div class="line">someArrayEntries.next(); // &#123;value: Array(2), done: false&#125;</div><div class="line">someArrayEntries.next(); // &#123;value: Array(2), done: false&#125;</div><div class="line">someArrayEntries.next(); // &#123;value: undefined, done: true&#125;</div></pre></td></tr></table></figure>
<p>上个例子中someArray.entries()生成了一个迭代器，每次调用next返回一个对象；当迭代到最后，返回{value: undefined, done: true}；<strong>并且特殊的是someArrayEntries也是一个符合iterable协议的可迭代对象，当调用<code>someArrayEntries[Symbol.iterator])</code>的时候返回一个迭代器对象就是其本身；</strong></p>
<h4 id="迭代器与可迭代对象的联系"><a href="#迭代器与可迭代对象的联系" class="headerlink" title="迭代器与可迭代对象的联系"></a>迭代器与可迭代对象的联系</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">iterableObj[Symbol.iterator]() ===&gt; iteratorObj;</div><div class="line">for （let v of iterableObj）&#123;</div><div class="line">  console.log(v);</div><div class="line">&#125;</div><div class="line">iteratorObj.next(); //&#123;value: v, done: false&#125;</div><div class="line">...</div><div class="line">iteratorObj.next(); //&#123;value: undefined, done: true&#125;</div></pre></td></tr></table></figure>
<p>以上介绍生成迭代器的方法还是针对具有Symbol.iterator属性的常见对象（如数组，map等）来的，怎么更通用的生成一个迭代器呢？</p>
<h4 id="内建迭代器"><a href="#内建迭代器" class="headerlink" title="内建迭代器"></a>内建迭代器</h4><p>1.集合对象迭代器</p>
<p>ES6中有三种类型集合对象： 数组、Map集合与Set集合。为了更好的访问对象中的内容，都内建了以下三种迭代器：</p>
<ul>
<li>entries() 返回一个迭代器，其值为多个键值对</li>
<li>values() 返回一个迭代器，其值为集合中的值</li>
<li>keys() 返回一个迭代器，其值为集合中的所有键名</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">let colors = [ &quot;red&quot;, &quot;green&quot;, &quot;blue&quot; ];</div><div class="line">for (let entry of colors.entries()) &#123;</div><div class="line">    console.log(entry);</div><div class="line">&#125;</div><div class="line">//[0, &quot;red&quot;]</div><div class="line">//[1, &quot;green&quot;]</div><div class="line">//[2, &quot;blue&quot;]</div><div class="line"></div><div class="line">let tracking = new Set([1234, 5678, 9012]);</div><div class="line">for (let value of tracking.values()) &#123;</div><div class="line">    console.log(value);</div><div class="line">&#125;</div><div class="line">// 1234</div><div class="line">// 5678</div><div class="line">// 9012</div><div class="line"></div><div class="line">let data = new Map();</div><div class="line">for (let key of data.keys()) &#123;</div><div class="line">    console.log(key);</div><div class="line">&#125;</div><div class="line">// &quot;title&quot;</div><div class="line">// &quot;format&quot;</div></pre></td></tr></table></figure>
<p>在for-of循环中，如果没有显式指定则使用默认的迭代器。数组和Set集合的默认迭代器是values()方法，Map默认迭代器是entries方法。</p>
<p>2.字符串迭代器和NodeList迭代器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var message = &quot;A 𠮷 B&quot;;</div><div class="line">for (let c of message) &#123;</div><div class="line">    console.log(c);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>NodeList迭代器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">var divs = document.getElementsByTagName(&quot;div&quot;);</div><div class="line">    for (let div of divs) &#123;</div><div class="line">        console.log(div.id);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="生成器"><a href="#生成器" class="headerlink" title="生成器"></a>生成器</h2><p>上面的例子中生成迭代器的方法还是针对具有Symbol.iterator属性的常见对象（如数组，map等）来的，怎么更通用的生成一个迭代器呢？</p>
<p>ES6中引入了生成器；生成器是一种返回迭代器的函数，通过function关键字后的*号来表示，函数中会用到新的关键字yield。星号可以紧挨着function关键字，也可以在中间添加一个空格，如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">function *createIterator() &#123;</div><div class="line">    yield 1;</div><div class="line">    yield 2;</div><div class="line">    yield 3;</div><div class="line">&#125;</div><div class="line">// generators are called like regular functions but return an iterator</div><div class="line">let iterator = createIterator();</div><div class="line">console.log(iterator);              // [object Generator]</div><div class="line">console.log(iterator.next().value); // 1</div><div class="line">console.log(iterator.next().value); // 2</div><div class="line">console.log(iterator.next().value); // 3</div></pre></td></tr></table></figure>
<p>上面的例子createIterator就是一个生成器，生成器执行返回的是一个生成器对象，<strong>生成器对象既是一个迭代器也是一个可迭代对象。</strong></p>
<h4 id="yield"><a href="#yield" class="headerlink" title="yield"></a>yield</h4><p>生成器函数最有趣的部分是：每当执行完一条yield语句后函数就会自动停止执行。</p>
<p>**yield关键字只可以在生成器内部使用，在其他地方使用会导致程序抛出语法错误，即便在生成器内部的函数里使用也是如此：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">function *createIterator(items) &#123;</div><div class="line">        items.forEach(function(item) &#123;</div><div class="line">            // syntax error</div><div class="line">            yield item + 1;</div><div class="line">        &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>从字面量上看，yield关键字确实在createIterator函数内部，但是它与return关键字一样，二者都不能穿透函数边界。嵌套函数中的return语句不能用做外部函数的返回语句，而此处嵌套函数中的yield语句会导致程序抛出语法错误。</p>
<h4 id="生成器函数表达式"><a href="#生成器函数表达式" class="headerlink" title="生成器函数表达式"></a>生成器函数表达式</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">let createIterator = function *(items) &#123;</div><div class="line">    for (let i = 0; i &lt; items.length; i++) &#123;</div><div class="line">        yield items[i];</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">let iterator = createIterator([1, 2, 3]);</div><div class="line">console.log(iterator.next()); // &quot;&#123; value: 1, done: false &#125;&quot;</div><div class="line">console.log(iterator.next()); // &quot;&#123; value: 2, done: false &#125;&quot;</div><div class="line">console.log(iterator.next()); // &quot;&#123; value: 3, done: false &#125;&quot;</div><div class="line">console.log(iterator.next()); // &quot;&#123; value: undefined, done: true &#125;&quot;</div></pre></td></tr></table></figure>
<p><strong>不能用箭头函数来创建生成器</strong></p>
<h4 id="生成器对象的方法"><a href="#生成器对象的方法" class="headerlink" title="生成器对象的方法"></a>生成器对象的方法</h4><p>由于生成器对象本身就是函数，因而可以将她们添加到对象中。例如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">let o = &#123;</div><div class="line">    createIterator: function *(items) &#123;</div><div class="line">        for (let i = 0; i &lt; items.length; i++) &#123;</div><div class="line">            yield items[i];</div><div class="line">        &#125;</div><div class="line">&#125; &#125;;</div><div class="line">let iterator = o.createIterator([1, 2, 3]);</div></pre></td></tr></table></figure>
<p>也可以用ES6对象方法的简写方式来创建生成器；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">let o = &#123;</div><div class="line">    *createIterator(items) &#123;</div><div class="line">        for (let i = 0; i &lt; items.length; i++) &#123;</div><div class="line">            yield items[i];</div><div class="line">        &#125;</div><div class="line">&#125; &#125;;</div><div class="line">let iterator = o.createIterator([1, 2, 3]);</div></pre></td></tr></table></figure>
<h2 id="高级生成器"><a href="#高级生成器" class="headerlink" title="高级生成器"></a>高级生成器</h2><p>生成器根据需求计算它们的产出值，这使得它们能够有效地表示计算成本高的序列，或者甚至如上所述的无限序列。</p>
<h4 id="给迭代器传递参数"><a href="#给迭代器传递参数" class="headerlink" title="给迭代器传递参数"></a>给迭代器传递参数</h4><p>The next() 方法也接受可用于修改生成器内部状态的值。传递给next()的值将被视为暂停生成器的最后一个yield表达式的结果。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">function* fibonacci() &#123;</div><div class="line">  var fn1 = 0;</div><div class="line">  var fn2 = 1;</div><div class="line">  while (true) &#123;  </div><div class="line">    var current = fn1;</div><div class="line">    fn1 = fn2;</div><div class="line">    fn2 = current + fn1;</div><div class="line">    var reset = yield current;</div><div class="line">    if (reset) &#123;</div><div class="line">        fn1 = 0;</div><div class="line">        fn2 = 1;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">var sequence = fibonacci();</div><div class="line">console.log(sequence.next().value);     // 0</div><div class="line">console.log(sequence.next().value);     // 1</div><div class="line">console.log(sequence.next().value);     // 1</div><div class="line">console.log(sequence.next().value);     // 2</div><div class="line">console.log(sequence.next().value);     // 3</div><div class="line">console.log(sequence.next().value);     // 5</div><div class="line">console.log(sequence.next().value);     // 8</div><div class="line">console.log(sequence.next(true).value); // 0</div><div class="line">console.log(sequence.next().value);     // 1</div><div class="line">console.log(sequence.next().value);     // 1</div><div class="line">console.log(sequence.next().value);     // 2</div></pre></td></tr></table></figure>
<h4 id="在迭代器中抛出错误"><a href="#在迭代器中抛出错误" class="headerlink" title="在迭代器中抛出错误"></a>在迭代器中抛出错误</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">function *createIterator() &#123;</div><div class="line">    let first = yield 1;</div><div class="line">    let second = yield first + 2;</div><div class="line">    yield second + 3;</div><div class="line">&#125;</div><div class="line">let iterator = createIterator();</div><div class="line">console.log(iterator.next()); // &#123;value: 1, done: false&#125;</div><div class="line">console.log(iterator.next(4)); // &#123;value: 6, done: false&#125;</div><div class="line">console.log(iterator.throw(new Error(&quot;Boom&quot;)));</div></pre></td></tr></table></figure>
<h4 id="生成器返回语句"><a href="#生成器返回语句" class="headerlink" title="生成器返回语句"></a>生成器返回语句</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">function *createIterator() &#123;</div><div class="line">    yield 1;</div><div class="line">    return 42;</div><div class="line">&#125;</div><div class="line">let iterator = createIterator();</div><div class="line">console.log(iterator.next()); // &quot;&#123; value: 1, done: false &#125;&quot;</div><div class="line">console.log(iterator.next()); // &quot;&#123; value: 42, done: true &#125;&quot;</div><div class="line">console.log(iterator.next()); // &quot;&#123; value: undefined, done: true &#125;&quot;</div></pre></td></tr></table></figure>
<p>上面例子中return语句返回一个值，该值被赋值给返回对象的value属性，本来第二条是返回<code>{ value: undefined, done: true }</code>的最终返回<code>{ value: 42, done: true }</code></p>
<h4 id="委托生成器"><a href="#委托生成器" class="headerlink" title="委托生成器"></a>委托生成器</h4><p>语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">yield* [[expression]];</div><div class="line">expression</div><div class="line">  返回一个可迭代对象的表达式。</div></pre></td></tr></table></figure>
<p><code>yield*</code> 表达式迭代操作数，并产生它返回的每个值。<code>yield*</code> 表达式本身的值是当迭代器关闭时返回的值（即done为true时）;</p>
<p>1.委托给其他生成器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">function* g1() &#123;</div><div class="line">  yield 2;</div><div class="line">  yield 3;</div><div class="line">  yield 4;</div><div class="line">&#125;</div><div class="line"></div><div class="line">function* g2() &#123;</div><div class="line">  yield 1;</div><div class="line">  yield* g1();</div><div class="line">  yield 5;</div><div class="line">&#125;</div><div class="line"></div><div class="line">var iterator = g2();</div><div class="line"></div><div class="line">console.log(iterator.next()); // &#123; value: 1, done: false &#125;</div><div class="line">console.log(iterator.next()); // &#123; value: 2, done: false &#125;</div><div class="line">console.log(iterator.next()); // &#123; value: 3, done: false &#125;</div><div class="line">console.log(iterator.next()); // &#123; value: 4, done: false &#125;</div><div class="line">console.log(iterator.next()); // &#123; value: 5, done: false &#125;</div><div class="line">console.log(iterator.next()); // &#123; value: undefined, done: true &#125;</div></pre></td></tr></table></figure>
<p>2.委托给其他可迭代对象</p>
<p>除了生成器对象这一种可迭代对象，yield* 还可以 yield 其它任意的可迭代对象，比如说数组、字符串、arguments 对象等等。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">function* g3() &#123;</div><div class="line">  yield* [1, 2];</div><div class="line">  yield* &quot;34&quot;;</div><div class="line">  yield* arguments;</div><div class="line">&#125;</div><div class="line"></div><div class="line">var iterator = g3(5, 6);</div><div class="line"></div><div class="line">console.log(iterator.next()); // &#123; value: 1, done: false &#125;</div><div class="line">console.log(iterator.next()); // &#123; value: 2, done: false &#125;</div><div class="line">console.log(iterator.next()); // &#123; value: &quot;3&quot;, done: false &#125;</div><div class="line">console.log(iterator.next()); // &#123; value: &quot;4&quot;, done: false &#125;</div><div class="line">console.log(iterator.next()); // &#123; value: 5, done: false &#125;</div><div class="line">console.log(iterator.next()); // &#123; value: 6, done: false &#125;</div><div class="line">console.log(iterator.next()); // &#123; value: undefined, done: true &#125;</div></pre></td></tr></table></figure>
<p>3.<code>yield*</code> 表达式的值</p>
<p><code>yield*</code> 是一个表达式，不是语句，所以它会有自己的值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">function* g4() &#123;</div><div class="line">  yield* [1, 2, 3];</div><div class="line">  return &quot;foo&quot;;</div><div class="line">&#125;</div><div class="line">var result;</div><div class="line">function* g5() &#123;</div><div class="line">  result = yield* g4();</div><div class="line">&#125;</div><div class="line">var iterator = g5();</div><div class="line"></div><div class="line">console.log(iterator.next()); // &#123; value: 1, done: false &#125;</div><div class="line">console.log(iterator.next()); // &#123; value: 2, done: false &#125;</div><div class="line">console.log(iterator.next()); // &#123; value: 3, done: false &#125;</div><div class="line">console.log(iterator.next()); // &#123; value: undefined, done: true &#125;, 此时 g4() 返回了 &#123; value: &quot;foo&quot;, done: true &#125;</div><div class="line">console.log(result);          // &quot;foo&quot;</div></pre></td></tr></table></figure>
<p>koa1源码中就有用到委托生成器语法；</p>
<h2 id="可迭代对象"><a href="#可迭代对象" class="headerlink" title="可迭代对象"></a>可迭代对象</h2><p>ES6中，所有的集合对象（数组、Set集合、Map集合）和字符串都是可迭代对象，这些对象中都有默认的迭代器；</p>
<p>之前的文章谈过可迭代对象，这里就总结一下：</p>
<h4 id="for-of循环"><a href="#for-of循环" class="headerlink" title="for-of循环"></a>for-of循环</h4><p>可迭代对象可用于for-of循环：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">let values = [1, 2, 3];</div><div class="line">for (let num of values) &#123;</div><div class="line">    console.log(num);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="spread-syntax-…"><a href="#spread-syntax-…" class="headerlink" title="spread syntax (…)"></a>spread syntax (…)</h4><p>可迭代对象可用于…语法：</p>
<p><code>[...&#39;abc&#39;]; // [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]</code></p>
<h4 id="用于yield"><a href="#用于yield" class="headerlink" title="用于yield *"></a>用于yield *</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">function* gen() &#123;</div><div class="line">  yield* [&apos;a&apos;, &apos;b&apos;, &apos;c&apos;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="用于解构"><a href="#用于解构" class="headerlink" title="用于解构"></a>用于解构</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">let [a, b, c] = new Set([&apos;a&apos;, &apos;b&apos;, &apos;c&apos;]);</div></pre></td></tr></table></figure>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/JS/" rel="tag"># JS</a>
          
            <a href="/tags/ES6/" rel="tag"># ES6</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/11/24/2017-11-24-ES6之类/" rel="next" title="ES6之class">
                <i class="fa fa-chevron-left"></i> ES6之class
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/11/27/2017-11-27-ES6之Set与Map/" rel="prev" title="ES6之Set与Map">
                ES6之Set与Map <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/abu.jpg"
                alt="cauil" />
            
              <p class="site-author-name" itemprop="name">cauil</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">37</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">分类</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">23</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/cauil" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://weibo.com/cauil" target="_blank" title="Weibo">
                    
                      <i class="fa fa-fw fa-weibo"></i>Weibo</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://douban.com/people/cauil" target="_blank" title="DouBan">
                    
                      <i class="fa fa-fw fa-douban"></i>DouBan</a>
                </span>
              
            
          </div>

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#迭代器"><span class="nav-number">1.</span> <span class="nav-text">迭代器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#迭代器协议"><span class="nav-number">1.0.1.</span> <span class="nav-text">迭代器协议</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#迭代器与可迭代对象的联系"><span class="nav-number">1.0.2.</span> <span class="nav-text">迭代器与可迭代对象的联系</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#内建迭代器"><span class="nav-number">1.0.3.</span> <span class="nav-text">内建迭代器</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#生成器"><span class="nav-number">2.</span> <span class="nav-text">生成器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#yield"><span class="nav-number">2.0.1.</span> <span class="nav-text">yield</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#生成器函数表达式"><span class="nav-number">2.0.2.</span> <span class="nav-text">生成器函数表达式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#生成器对象的方法"><span class="nav-number">2.0.3.</span> <span class="nav-text">生成器对象的方法</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#高级生成器"><span class="nav-number">3.</span> <span class="nav-text">高级生成器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#给迭代器传递参数"><span class="nav-number">3.0.1.</span> <span class="nav-text">给迭代器传递参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#在迭代器中抛出错误"><span class="nav-number">3.0.2.</span> <span class="nav-text">在迭代器中抛出错误</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#生成器返回语句"><span class="nav-number">3.0.3.</span> <span class="nav-text">生成器返回语句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#委托生成器"><span class="nav-number">3.0.4.</span> <span class="nav-text">委托生成器</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#可迭代对象"><span class="nav-number">4.</span> <span class="nav-text">可迭代对象</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#for-of循环"><span class="nav-number">4.0.1.</span> <span class="nav-text">for-of循环</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#spread-syntax-…"><span class="nav-number">4.0.2.</span> <span class="nav-text">spread syntax (…)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#用于yield"><span class="nav-number">4.0.3.</span> <span class="nav-text">用于yield *</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#用于解构"><span class="nav-number">4.0.4.</span> <span class="nav-text">用于解构</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">cauil</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  

  
  

  

  

  

</body>
</html>
